<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="HTML5 Asteroids game by Travis Luong">
	<meta name="keywords" content="asteroids, space shooter, html5, indie, browser-based, javascript, arcade, retro, oldschool, travis luong">
	<title>HTML5 Asteroids</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<body>
	<div id="ad">
	</div>
	<div id="header">
		<h1>HTML5 Asteroids</h1>
		<div id="author">by <a href="http://www.travisluong.com">Travis Luong</a></div>
	</div>
	<div id="stage"></div>
	<div id="instructions">

	</div>
	<script type="text/javascript">
// declare globals
var WIDTH = 800;
var HEIGHT = 600;

// create the canvas
var canvas = document.createElement("canvas");
var ctx = canvas.getContext("2d");
canvas.width = WIDTH;
canvas.height = HEIGHT;
document.getElementById("stage").appendChild(canvas);

// load images
ship_info = new ImageInfo(45, 45, 90, 90, 35, false);
var ship_img = new Image();
ship_img.onload = function () {
	ship_info.img_ready = true;
}
ship_img.src = "img/double_ship.png";

asteroid_info = new ImageInfo(45, 45, 90, 90, 40, false);
var asteroid_img = new Image();
asteroid_img.onload = function () {
	asteroid_info.img_ready = true;
}
asteroid_img.src = "img/asteroid_blue.png";

// image info class
function ImageInfo(x_center, y_center, width, height, radius, lifespan, animated, img_ready) {
	this.x_center = x_center;
	this.y_center = y_center;
	this.width = width;
	this.height = height;
	this.radius = radius;
	this.lifespan = lifespan;
	this.animated = animated;
	this.img_ready = img_ready;
};

// angle to vector helper function
var angle_to_vector = function (ang) {
	return [Math.cos(ang), Math.sin(ang)];
};

// draw sprite helper function
var draw_sprite = function () {

}

// ship class
function Ship(x, y, x_vel, y_vel, ang, ang_vel, image, info) {
	this.x = x;
	this.y = y;
	this.x_vel = x_vel;
	this.y_vel = y_vel;
	this.thrust = true;
	this.ang = ang;
	this.ang_vel = ang_vel;
	this.image = image;
	this.image_center_x = info.x_center;
	this.image_center_y = info.y_center;
	this.radius = info.radius;
	this.draw = function () {
		// save context
		ctx.save();
		// move origin to the x and y position of ship
		ctx.translate(this.x, this.y);
		// rotate ship
		ctx.rotate(this.ang);
		if (info.img_ready) {
			// drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
			if (this.thrust) {
				ctx.drawImage(image, 90, 0, info.width, info.height, -this.image_center_x, -this.image_center_y, info.width, info.height);
			} else {
				ctx.drawImage(image, 0, 0, info.width, info.height, -this.image_center_x, -this.image_center_y, info.width, info.height);
			}
		}
		// restore context
		ctx.restore();
	};
	this.update = function (modifier) {
		// update thrust
		if (38 in keysDown) { // up
			this.thrust = true;
		} else {
			this.thrust = false;
		}
		// update ang velocity
		if (37 in keysDown && 39 in keysDown) {
			this.ang_vel = 0;
		} else if (37 in keysDown) { // left
			this.ang_vel = -5;
		} else if (39 in keysDown) { // right
			this.ang_vel = 5;
		} else {
			this.ang_vel = 0;
		}
		// update ang
		this.ang += this.ang_vel * modifier;
		// update position
		if (this.y <= 0) {
			this.y = HEIGHT;
		} else {
			this.y = (this.y + (this.y_vel * modifier)) % HEIGHT;
		}
		if (this.x <= 0) {
			this.x = WIDTH;
		} else {
			this.x = (this.x + (this.x_vel * modifier)) % WIDTH;
		}
		// update velocity
		if (this.thrust) {
			var acc = angle_to_vector(this.ang);
			this.x_vel += acc[0] * 10;
			this.y_vel += acc[1] * 10;
		}
		// friction
		this.x_vel *= 0.99;
		this.y_vel *= 0.99;
	};
	return this;
};

function Sprite(x, y, x_vel, y_vel, ang, ang_vel, image, info, sound) {
	this.x = x;
	this.y = y;
	this.x_vel = x_vel;
	this.y_vel = y_vel;
	this.ang = ang;
	this.ang_vel = ang_vel;
	this.image = image;
	this.sound = sound;
	this.draw = function () {
		// save context
		ctx.save();
		// move origin to the x and y position of sprite
		ctx.translate(this.x, this.y);
		// rotate sprite
		ctx.rotate(this.ang);
		if (ship_img_ready) {
			// drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
			ctx.drawImage(image, 90, 0, info.width, info.height, -this.image_center_x, -this.image_center_y, info.width, info.height);
		}
		// restore context
		ctx.restore();
	}
}

var my_ship = new Ship(200, 200, 0, 0, 0, 0, ship_img, ship_info);

// handle keyboard controls
var keysDown = {};

addEventListener("keydown", function (e) {
	keysDown[e.keyCode] = true;
	switch(e.keyCode){
        case 37: case 39: case 38:  case 40: // arrow keys
        case 32: e.preventDefault(); break; // space
        default: break; // do not block other keys
    }
}, false);

addEventListener("keyup", function (e) {
	delete keysDown[e.keyCode];
}, false);

// reset the game
var reset = function () {

};

// update game objects
var update = function (modifier) {
	my_ship.update(modifier);
};

// draw everything
var render = function () {

	// draw background
	ctx.fillStyle = "black";
	ctx.fillRect(0, 0, canvas.width, canvas.height);

	// draw ship
	my_ship.draw();

		// draw position
		ctx.fillStyle = "rgb(250, 250, 250)";
		ctx.font = "24px Helvetica";
		ctx.textAlign = "left";
		ctx.textBaseline = "top";
		ctx.fillText(my_ship.x, 32, 32);
		ctx.fillText(my_ship.y, 558, 32);
};

// the main game loop
var main = function () {
	var now = Date.now();
	var delta = now - then;

	update(delta / 1000);
	render();

	then = now;
};

// let's play this game!
reset();
var then = Date.now();
setInterval(main, 1); // execute as fast as possible
</script>
</body>
</html>